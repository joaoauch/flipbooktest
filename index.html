<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microlibro Noviazgo Católico</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the application */
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrollbars on the body */
        }
        /* Style for the page container to maintain aspect ratio */
        #page-container {
            position: relative;
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
            max-width: 576px; /* Max width from original */
            max-height: 576px; /* Max height from original */
        }
        #page-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        /* Hotspot styling */
        .hotspot {
            position: absolute;
            background-color: rgba(70, 114, 226, 0.3);
            border: 2px solid rgba(70, 114, 226, 0.8);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hotspot:hover {
            background-color: rgba(70, 114, 226, 0.5);
            transform: scale(1.05);
        }
        /* Icon inside the hotspot */
        .hotspot-icon {
            color: white;
            background-color: #4672E2;
            border-radius: 50%;
            padding: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        /* Modal styles */
        #modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        #modal-content {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <!-- Header Section -->
        <header class="text-center mb-4">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Microlibro Noviazgo Católico</h1>
            <p class="text-sm text-gray-500">An interactive flipbook experience</p>
        </header>

        <!-- Flipbook Container -->
        <main id="flipbook-container" class="bg-white rounded-lg shadow-2xl p-4 md:p-6 flex flex-col items-center">
            <!-- Page Display Area -->
            <div id="page-container" class="bg-gray-200 rounded-md overflow-hidden shadow-inner mb-4">
                <img id="page-image" src="https://d2yzdrigfuozes.cloudfront.net/939509/2061891/1.jpeg" alt="Page 1">
                <!-- Hotspots will be injected here by JavaScript -->
                <div id="hotspot-layer"></div>
            </div>

            <!-- Navigation Controls -->
            <div class="flex items-center justify-between w-full">
                <button id="prev-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none">
                    Previous
                </button>
                <div class="text-center">
                    <span id="page-indicator" class="text-lg font-semibold text-gray-700">Page 1 of 76</span>
                    <a id="download-btn" href="https://d2z1mhfwexgacj.cloudfront.net/939509/2061891/pdf/2061891.pdf?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cCo6Ly9kMnoxbWhmd2V4Z2Fjai5jbG91ZGZyb250Lm5ldC85Mzk1MDkvMjA2MTg5MS8qIiwiQ29uZGl0aW9uIjp7IkRhdGVMZXNzVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNzU0MDg5NzU2fX19XX0_&Key-Pair-Id=K18OAPGUYFDCND&Signature=RKhnSdNPhE0f%7E%7E4Zv6KzHTn0TAfMokVaUK9wFEJynVf52WTAQ9WTcMIbBiUqBPpp7xHZS6Il0NVQ6lj6EhxSMkl9H%7EzPb9Q4OLrO5JrJKmWe0CPqvVh9iDiNWcPAIWG0%7EX%7E5kohUxCkV0Z%7EjXJIOQR5HKXqO2v3g2doCg6vB3tRgRJvEBBOg%7EJmH4W1Swvp3rgTy-bagEkhQma6CyEPiJd5tiXGwou3JE3IVvqmJgUqCPvrK8iK3SdUnED8g3z2L7D96fbdGkaUInhP3h3DWQ860X%7E1OtXy-TiFCDOmZUiKbrEusCa-FDDe0Wixb4KlgGiiFd33HVzaWR4DfHKYifA__" target="_blank" class="ml-4 text-blue-600 hover:text-blue-800 hover:underline">Download PDF</a>
                </div>
                <button id="next-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none">
                    Next
                </button>
            </div>
        </main>
    </div>

    <!-- Modal for Videos and Links -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div id="modal-content" class="bg-white rounded-lg shadow-xl w-full max-w-3xl transform scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modal-title" class="text-xl font-semibold">Interactive Content</h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="modal-body" class="p-4" style="height: 70vh;">
                <!-- Iframe for content will be placed here -->
            </div>
        </div>
    </div>

    <!-- Audio Player (hidden) -->
    <audio id="audio-player"></audio>

    <script>
        // --- CONFIGURATION ---
        const config = {
            totalPages: 76,
            // Asset URLs are derived from the original source
            pageUrlTemplate: "https://d2yzdrigfuozes.cloudfront.net/939509/2061891/{page}.jpeg",
            // Hotspot data extracted from the original bookModel JSON
            hotspots: [
                {
                    page: 1, // Corresponds to page 0 in original data
                    type: 'audio',
                    position: { x: 0, y: 0, width: 19.8, height: 19.8 },
                    iconPosition: { x: 33.936, y: 23.955 },
                    data: {
                        url: "https://d1u9ua4yk0lyeu.cloudfront.net/cms/publishers/939509/2061891/flipbook-assets/1474968992688d1f608a7791.14506662.mp3",
                        loop: true
                    }
                },
                {
                    page: 1,
                    type: 'link',
                    position: { x: 42.356, y: 39.921, width: 19.8, height: 19.8 },
                    iconPosition: { x: 34.848, y: 34.848 },
                    data: {
                        url: "https://joaoauch.github.io/noviazgoconproposito/",
                        title: "Visit Noviazgo con Propósito"
                    }
                },
                {
                    page: 1,
                    type: 'video',
                    position: { x: 27.435, y: 25, width: 50, height: 28.125 },
                    iconPosition: { x: 44, y: 39.334 },
                    data: {
                        url: "https://d1u9ua4yk0lyeu.cloudfront.net/cms/publishers/939509/2061891/flipbook-assets/936170934688d20fabb48c9.25089929.mp4",
                        title: "Introductory Video"
                    }
                },
                {
                    page: 2, // Corresponds to page 1 in original data
                    type: 'audio',
                    position: { x: 4.212, y: 4.941, width: 19.8, height: 19.8 },
                    iconPosition: { x: 34.848, y: 34.848 },
                    data: {
                        url: "https://d1u9ua4yk0lyeu.cloudfront.net/cms/publishers/939509/2061891/flipbook-assets/1206791891688d200e5ce599.06163384.mp3",
                        loop: false
                    }
                }
            ]
        };

        // --- STATE ---
        let currentPage = 1;

        // --- DOM ELEMENTS ---
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageIndicator = document.getElementById('page-indicator');
        const pageImage = document.getElementById('page-image');
        const hotspotLayer = document.getElementById('hotspot-layer');
        const audioPlayer = document.getElementById('audio-player');
        
        // Modal elements
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // --- FUNCTIONS ---

        /**
         * Renders the current page content, including the image and any interactive hotspots.
         */
        function renderPage() {
            // 1. Update Page Image
            const imageUrl = config.pageUrlTemplate.replace('{page}', currentPage);
            pageImage.src = imageUrl;
            pageImage.alt = `Page ${currentPage}`;

            // 2. Update Page Indicator
            pageIndicator.textContent = `Page ${currentPage} of ${config.totalPages}`;

            // 3. Update Navigation Buttons State
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === config.totalPages;

            // 4. Render Hotspots
            renderHotspots();
        }

        /**
         * Clears existing hotspots and renders new ones for the current page.
         */
        function renderHotspots() {
            // Clear previous hotspots
            hotspotLayer.innerHTML = '';

            // Find hotspots for the current page
            const pageHotspots = config.hotspots.filter(h => h.page === currentPage);

            // Create and append each hotspot element
            pageHotspots.forEach(hotspotData => {
                const hotspotEl = document.createElement('div');
                hotspotEl.className = 'hotspot';
                
                // Position and size the hotspot based on percentage values
                hotspotEl.style.left = `${hotspotData.position.x}%`;
                hotspotEl.style.top = `${hotspotData.position.y}%`;
                hotspotEl.style.width = `${hotspotData.position.width}%`;
                hotspotEl.style.height = `${hotspotData.position.height}%`;
                
                // Add an icon inside the hotspot
                let iconSvg = '';
                switch(hotspotData.type) {
                    case 'audio':
                        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>`;
                        break;
                    case 'link':
                        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>`;
                        break;
                    case 'video':
                        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>`;
                        break;
                }
                hotspotEl.innerHTML = `<div class="hotspot-icon">${iconSvg}</div>`;
                
                // Add click event listener
                hotspotEl.addEventListener('click', () => handleHotspotClick(hotspotData));

                hotspotLayer.appendChild(hotspotEl);
            });
        }

        /**
         * Handles the click event on a hotspot, triggering the appropriate action.
         * @param {object} hotspotData - The configuration object for the clicked hotspot.
         */
        function handleHotspotClick(hotspotData) {
            switch (hotspotData.type) {
                case 'audio':
                    playAudio(hotspotData.data.url, hotspotData.data.loop);
                    break;
                case 'link':
                    showModal('link', hotspotData.data);
                    break;
                case 'video':
                    showModal('video', hotspotData.data);
                    break;
            }
        }

        /**
         * Plays or pauses an audio file.
         * @param {string} url - The URL of the audio file.
         * @param {boolean} loop - Whether the audio should loop.
         */
        function playAudio(url, loop = false) {
            // If it's the same audio and it's playing, pause it.
            if (audioPlayer.src === url && !audioPlayer.paused) {
                audioPlayer.pause();
            } else {
                // Otherwise, set the new source and play.
                audioPlayer.src = url;
                audioPlayer.loop = loop;
                audioPlayer.play().catch(e => console.error("Audio playback failed:", e));
            }
        }

        /**
         * Shows the modal with the specified content type and data.
         * @param {string} type - The type of content ('link' or 'video').
         * @param {object} data - The data for the content (URL, title).
         */
        function showModal(type, data) {
            modalTitle.textContent = data.title;
            let contentHtml = '';

            if (type === 'link') {
                contentHtml = `<iframe src="${data.url}" class="w-full h-full border-0" title="${data.title}"></iframe>`;
            } else if (type === 'video') {
                contentHtml = `<video src="${data.url}" class="w-full h-full" controls autoplay muted playsinline></video>`;
            }

            modalBody.innerHTML = contentHtml;
            modalBackdrop.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.style.opacity = '1';
                modalContent.style.transform = 'scale(1)';
            }, 10); // Short delay to allow CSS transition
        }

        /**
         * Hides the modal window.
         */
        function hideModal() {
            modalBackdrop.style.opacity = '0';
            modalContent.style.transform = 'scale(0.95)';
            setTimeout(() => {
                modalBackdrop.classList.add('hidden');
                modalBody.innerHTML = ''; // Clear content to stop video/audio
            }, 300); // Match transition duration
        }

        // --- EVENT LISTENERS ---
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderPage();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage < config.totalPages) {
                currentPage++;
                renderPage();
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                prevBtn.click();
            } else if (e.key === 'ArrowRight') {
                nextBtn.click();
            } else if (e.key === 'Escape') {
                hideModal();
            }
        });

        // Modal close events
        closeModalBtn.addEventListener('click', hideModal);
        modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) {
                hideModal();
            }
        });

        // --- INITIALIZATION ---
        window.addEventListener('load', renderPage);

    </script>
</body>
</html>
